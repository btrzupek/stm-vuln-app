const github = require('@actions/github');
const { Octokit } = require('@octokit/octokit');

const octokit = new Octokit({
  auth: process.env.GITHUB_TOKEN,
});

const scannerToken = process.env.SCANNER_TOKEN;
const scannerName = process.env.SCANNER_NAME;
const repoToken = process.env.REPO_TOKEN;

async function run() {
  const { data: vulnerabilities } = await octokit.get(`/${scannerName}/scan`, {
    headers: {
      Authorization: `Bearer ${scannerToken}`,
    },
  });

  // Process the vulnerability results
  const results = vulnerabilities.map((vulnerability) => ({
    id: vulnerability.id,
    severity: vulnerability.severity,
    description: vulnerability.description,
  }));

  // Send the results to your separate process or service
  const response = await fetch('https://your-process-url.com/vulnerabilities', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(results),
  });

  if (response.ok) {
    console.log('Vulnerability results sent successfully!');
  } else {
    console.error('Error sending vulnerability results:', response.statusText);
  }
}

run();

